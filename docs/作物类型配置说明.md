# 作物类型配置说明

## 📋 概述

时序变化分析模块使用 `gridcode` 字段来识别作物类型。你可以根据实际的数据情况，自定义作物类型映射表。

## 🔧 配置位置

作物类型映射表位于：`src/utils/temporalAnalysis.js`

## 📝 默认配置

```javascript
const CROP_TYPE_MAP = {
  0: '未种植',
  1: '水稻',
  2: '小麦',
  3: '玉米',
  4: '大豆',
  5: '油菜',
  6: '棉花',
  7: '蔬菜',
  8: '果树',
  9: '其他作物'
}
```

## ✏️ 自定义配置步骤

### 1. 打开配置文件

找到并打开 `src/utils/temporalAnalysis.js` 文件

### 2. 修改映射表

根据你的 GeoJSON 数据中的 `gridcode` 值，修改对应的作物名称：

```javascript
const CROP_TYPE_MAP = {
  1: '早稻',      // 修改为你的实际作物名称
  2: '晚稻',
  3: '冬小麦',
  4: '春小麦',
  5: '玉米',
  6: '大豆',
  7: '花生',
  8: '棉花',
  // ... 添加更多类型
}
```

### 3. 保存并重启

修改完成后保存文件，重新启动项目即可生效。

## 📊 数据字段说明

### GeoJSON数据格式要求

时序分析功能要求GeoJSON数据包含以下字段：

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "Id": 1,           // 地块唯一标识（必需）
        "gridcode": 1,     // 作物类型代码（必需）
        "area": 120.5,     // 地块面积（可选）
        "plotName": "地块1" // 地块名称（可选）
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [...]
      }
    }
  ]
}
```

### 字段配置

如果你的数据字段名称与默认不同，可以在调用分析函数时指定：

在 `src/views/TaskManagement/index.vue` 中找到 `performTemporalAnalysis` 函数，修改配置：

```javascript
const analysisResult = buildTemporalTrajectories(timePointsData, {
  idField: 'Id',        // 修改为你的ID字段名
  cropField: 'gridcode', // 修改为你的作物字段名
  areaField: 'area'      // 修改为你的面积字段名
})
```

## 🎨 可视化配置

### 作物颜色配置

在 `src/views/ResultCompare/components/CropDistributionChart.vue` 中可以自定义作物颜色：

```javascript
const cropColors = [
  '#67c23a', // 绿色
  '#409eff', // 蓝色
  '#e6a23c', // 橙色
  '#f56c6c', // 红色
  '#909399', // 灰色
  // 添加更多颜色
]
```

## 🔍 数据验证

在执行时序分析前，请确保：

1. ✅ 每个时间点的GeoJSON文件都包含必需字段
2. ✅ `Id` 字段在同一时间点内唯一
3. ✅ `gridcode` 值在映射表中有对应的名称
4. ✅ 不同时间点的相同地块具有相同的 `Id` 值

## 📖 使用示例

### 示例1：查看实际的gridcode值

在浏览器控制台中，上传GeoJSON文件后可以查看实际数据：

```javascript
// 打开浏览器开发者工具的控制台
// 查看加载的GeoJSON数据中的gridcode值
console.log('作物代码:', geojsonData.features[0].properties.gridcode)
```

### 示例2：批量更新作物类型

如果需要批量更新大量作物类型，可以使用以下方式：

```javascript
const CROP_TYPE_MAP = {}
// 自动生成1-100的映射
for (let i = 1; i <= 100; i++) {
  CROP_TYPE_MAP[i] = `作物类型${i}`
}
```

## ⚠️ 注意事项

1. **数据一致性**：确保所有时间点的GeoJSON文件使用相同的作物编码标准
2. **ID唯一性**：地块ID应该在整个时间序列中保持一致
3. **编码范围**：作物编码应该是合理的数字范围（建议0-100）
4. **字段名称**：确保字段名称大小写准确

## 🆘 常见问题

### Q1: 为什么显示"作物1"而不是实际作物名称？

**A:** 这说明你的 `gridcode` 值在 `CROP_TYPE_MAP` 中没有对应项。请检查实际数据中的 `gridcode` 值，并在映射表中添加对应项。

### Q2: 不同时间点的地块无法匹配？

**A:** 请确保：
- 相同地块在不同时间点的 `Id` 字段值完全相同
- 如果使用几何匹配，确保地块位置没有大幅偏移

### Q3: 如何查看我的数据中有哪些gridcode值？

**A:** 在执行分析后，打开浏览器控制台，运行：

```javascript
const codes = new Set()
geojsonData.features.forEach(f => codes.add(f.properties.gridcode))
console.log('所有作物代码:', Array.from(codes).sort())
```

## 📚 更多信息

如需更多帮助，请查看：
- [时序变化分析使用指南](./功能使用指南.md)
- [快速开始](./快速开始.md)



