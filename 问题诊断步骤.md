# 问题诊断步骤

## 问题1：统计信息卡片样式不显示

### 诊断步骤：

1. **强制刷新浏览器缓存**
   - 按 `Ctrl + Shift + Delete`
   - 选择"缓存的图片和文件"
   - 点击"清除数据"
   - 或者按 `Ctrl + F5` 强制刷新

2. **检查CSS是否生效**
   - 按 `F12` 打开开发者工具
   - 点击右上角"统计信息"卡片
   - 在开发者工具的Elements标签中找到对应元素
   - 查看是否有 `background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)`
   - 如果没有，说明CSS未生效

3. **在控制台运行以下命令检查**
```javascript
// 检查统计卡片元素
const statsCard = document.querySelector('.stats-card')
console.log('统计卡片元素:', statsCard)
console.log('统计卡片计算样式:', window.getComputedStyle(statsCard.querySelector('.el-card__header')).background)
```

---

## 问题2：作物类型分布不显示

### 诊断步骤：

1. **在控制台运行以下命令**
```javascript
// 检查cropChart是否初始化
console.log('cropChart对象:', window.cropChart || 'cropChart未挂载到window')

// 检查chart DOM元素
const chartDom = document.getElementById('crop-chart')
console.log('chart DOM元素:', chartDom)
console.log('chart DOM尺寸:', chartDom ? `${chartDom.offsetWidth}x${chartDom.offsetHeight}` : '未找到')
```

2. **查看控制台是否有这些输出**
   - "统计数据 cropDistribution:"
   - "最终饼图数据:"
   - "✅ 饼图已完全重新设置"

3. **如果没有输出，检查是否调用了updateStatistics**
```javascript
// 手动触发统计更新（在控制台运行）
// 这会告诉我们updateStatistics是否被调用
console.log('当前影像数据:', Vue?.config?.globalProperties?.$currentImageData)
```

---

## 问题3：KMZ文件加载失败

### 错误分析：
```
Error: Can't find end of central directory : is this a zip file ?
```

这个错误表示：
1. **文件路径错误** - 可能访问到了错误的文件或404页面
2. **文件格式问题** - KMZ文件可能损坏

### 诊断步骤：

1. **检查控制台输出的完整路径**
   - 查找 "文件完整路径:" 开头的日志
   - 复制该URL
   - 在浏览器新标签页中直接访问该URL
   - 如果显示404或HTML页面，说明路径错误
   - 如果提示下载文件，说明路径正确

2. **在控制台运行以下命令检查路径**
```javascript
// 获取识别结果数据
fetch('/api/analysis/results')
  .then(res => res.json())
  .then(data => {
    console.log('识别结果列表:', data)
    const yzcFile = data.results.find(f => f.name === 'YZC.kmz')
    console.log('YZC文件信息:', yzcFile)
    console.log('relativePath:', yzcFile?.relativePath)
    
    // 构建URL（和代码中一样）
    const normalizedPath = yzcFile.relativePath.replace(/\\/g, '/')
    const fullUrl = `http://localhost:3000/data/data_kmz/${normalizedPath}`
    console.log('构建的URL:', fullUrl)
    console.log('👆 请复制这个URL到浏览器地址栏测试')
  })
```

3. **测试KMZ文件是否有效**
   - 找到文件：`public/data/data_kmz/planting_situation/YZC/YZC.kmz`
   - 尝试用解压软件（如7-Zip、WinRAR）打开
   - 如果无法打开，说明文件损坏
   - 如果能打开，检查里面是否有 `.kml` 文件

---

## 快速诊断脚本（直接在控制台粘贴运行）

```javascript
console.log('=== 开始诊断 ===')

// 1. 检查统计卡片样式
const statsCard = document.querySelector('.stats-card')
const statsHeader = statsCard?.querySelector('.el-card__header')
if (statsHeader) {
  const bg = window.getComputedStyle(statsHeader).background
  console.log('✅ 统计卡片头部背景:', bg)
  console.log(bg.includes('667eea') ? '✅ 紫色渐变已应用' : '❌ 紫色渐变未应用')
} else {
  console.log('❌ 未找到统计卡片')
}

// 2. 检查cropChart
const chartDom = document.getElementById('crop-chart')
if (chartDom) {
  console.log('✅ cropChart DOM元素存在')
  console.log('   尺寸:', `${chartDom.offsetWidth}x${chartDom.offsetHeight}`)
  
  // 尝试获取echarts实例
  const instance = echarts.getInstanceByDom(chartDom)
  console.log(instance ? '✅ ECharts实例存在' : '❌ ECharts实例不存在')
  if (instance) {
    const option = instance.getOption()
    console.log('   当前数据:', option.series[0].data)
  }
} else {
  console.log('❌ cropChart DOM元素不存在')
}

// 3. 检查KMZ路径
fetch('/api/analysis/results')
  .then(res => res.json())
  .then(data => {
    console.log('✅ 获取识别结果成功，共', data.results.length, '个文件')
    const yzcFile = data.results.find(f => f.name === 'YZC.kmz')
    if (yzcFile) {
      console.log('✅ 找到YZC.kmz')
      console.log('   relativePath:', yzcFile.relativePath)
      const normalizedPath = yzcFile.relativePath.replace(/\\/g, '/')
      const fullUrl = `http://localhost:3000/data/data_kmz/${normalizedPath}`
      console.log('   完整URL:', fullUrl)
      console.log('👉 请手动访问此URL测试:', fullUrl)
    } else {
      console.log('❌ 未找到YZC.kmz')
    }
  })
  .catch(err => console.error('❌ 获取识别结果失败:', err))

console.log('=== 诊断完成 ===')
```

---

## 预期结果

### 正常情况应该看到：
1. ✅ 统计卡片头部背景: linear-gradient(...)
2. ✅ 紫色渐变已应用
3. ✅ cropChart DOM元素存在
4. ✅ ECharts实例存在
5. ✅ 找到YZC.kmz
6. 完整URL应该类似：`http://localhost:3000/data/data_kmz/planting_situation/YZC/YZC.kmz`

### 如果看到❌，请截图告诉我具体哪一步失败了！

